# Lucid - 要件定義

## ビジョン

**「AIの中で暮らすOS」** — チャットではなく、共在する。

AIエージェントがコモディティ化した世界で、差別化はUIにしかない。
Lucidは明晰夢のように「AIの中にいることを自覚しながら自然に暮らせる」環境を提供する。

## 3つのパラダイムシフト

### 1. チャット欄を殺す → 共有キャンバス

| Hive（旧）| Lucid（新）|
|-----------|-----------|
| 指示 → 応答のターンベース | 共同作業中にAIが自律的に動く |
| メッセージが情報の単位 | キャンバス上のオブジェクトが情報の単位 |
| 会話履歴をスクロール | 空間的にナビゲーション |
| 1対1の対話 | 多対多の共在（人間+AI+AI） |

**人間同士のコミュニケーション**: 消えるのではなく変容する
- テキストチャット → キャンバス上のアノテーション
- 「送信」ボタン → 同じ空間にいるだけで共有
- 既読/未読 → 存在感・注目度のグラデーション

### 2. エージェントは「相手」ではなく「環境」

| 従来 | Lucid |
|------|-------|
| プロンプトを書く | 行動するだけ |
| AIに「指示」する | AIが「察する」|
| 明示的なコマンド | 面積分的な意図推論 |
| エージェント選択 | コンテキストに応じて自動切替 |

**面積分的意図推論**:
- ユーザーの連続的な行動（クリック、スクロール、タイピング、停止）を時間軸で統合
- 単一の行動ではなく、行動の「面積」から意図を推定
- 例: ドキュメントを3回読み返す + 特定箇所で停止 → 「ここが理解できていない」と推論

### 3. 信頼のグラデーション設計

| 従来 | Lucid |
|------|-------|
| 許可 / 拒否の二値 | 信頼度0〜100のスペクトラム |
| 全データ見えるor見えない | 信頼度に応じて情報が有機的に流れる |
| 権限はユーザーが手動設定 | 行動履歴から信頼度が自動調整 |
| セキュリティ = 壁 | セキュリティ = 膜（浸透圧）|

**信頼度モデル**:
- 新しいAIエージェント: 信頼度20（基本情報のみアクセス）
- 使い込んだエージェント: 信頼度80（個人データも自然に流れる）
- ユーザーが明示的に信頼を上げ下げ可能

---

## 機能要件

### コア機能

#### A. 共有キャンバス

| 機能 | 説明 | 優先度 |
|------|------|--------|
| リアルタイム共同編集 | CRDT（Yjs）ベースの共有状態 | P0 |
| オブジェクト配置 | テキスト/画像/コード/ファイルをキャンバスに配置 | P0 |
| 空間ナビゲーション | ズーム/パン/ミニマップ | P0 |
| カーソル共有 | 他ユーザー・AIの作業位置をリアルタイム表示 | P1 |
| テンプレート | プロジェクト管理/ブレスト/ドキュメント等の初期レイアウト | P2 |

#### B. 環境型エージェント

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 行動トラッキング | ユーザーの操作を非侵襲的に収集 | P0 |
| 意図推論エンジン | 面積分的に行動を統合→意図を推定 | P0 |
| 自律的アクション | 推論結果に基づきキャンバスに提案を配置 | P0 |
| コンテキスト切替 | 作業内容に応じてエージェントの専門性が動的に変化 | P1 |
| 学習・適応 | ユーザーの承認/却下フィードバックで精度向上 | P1 |

#### C. 信頼グラデーション

| 機能 | 説明 | 優先度 |
|------|------|--------|
| 信頼度スコア | エージェント/ユーザーごとの信頼度数値管理 | P0 |
| 情報フィルタリング | 信頼度に応じたデータアクセス範囲の自動調整 | P0 |
| 信頼度UI | 直感的な信頼度の確認・手動調整 | P1 |
| 信頼度履歴 | 信頼度変動の可視化とレビュー | P2 |

### 人間コミュニケーション機能

| 機能 | 説明 | 優先度 |
|------|------|--------|
| アノテーション | キャンバス上の任意位置にコメント | P0 |
| 存在感表示 | 誰がどこを見ているかのリアルタイム表示 | P1 |
| リアクション | オブジェクトへの絵文字リアクション | P2 |
| 通知 | 重要な変更・メンションの通知 | P1 |
| DM（フォールバック） | 従来型テキストチャット（必要時のみ） | P2 |

---

## 技術アーキテクチャ

### データモデルの変革

```
Hive: イベント中心（Matrix Protocol）
  events → room → members → messages

Lucid: 状態中心（CRDT）
  canvas → objects → presence → trust
```

### 技術スタック（案）

| レイヤー | 技術 | 理由 |
|---------|------|------|
| フロントエンド | Next.js 15 + React | Hiveからの継続性 |
| キャンバス | tldraw or Excalidraw | OSS共同編集キャンバス |
| リアルタイム同期 | Yjs + WebSocket | CRDTベースのコンフリクトフリー同期 |
| 永続化 | Supabase（PostgreSQL）| 認証・ストレージ統合 |
| AI推論 | ローカル or クラウドLLM | コモディティ前提で柔軟に |
| 行動トラッキング | カスタム（イベントバス）| フロントエンドでの行動収集 |
| 信頼エンジン | カスタム（ルールベース→ML）| 段階的に高度化 |

### Hiveからの移行パス

| Hiveの資産 | Lucidでの扱い |
|-----------|--------------|
| Supabase Auth | そのまま利用 |
| events テーブル | CRDTオブジェクトに変換 |
| rooms | キャンバス（canvas）に対応 |
| agents テーブル | 環境型エージェントに拡張 |
| UI コンポーネント | 基盤（shadcn/ui）は再利用 |

---

## 非機能要件

| 項目 | 要件 |
|------|------|
| リアルタイム性 | 操作反映 < 50ms（ローカル）、< 200ms（リモート）|
| オフライン | CRDTによりオフライン編集→再接続時に自動マージ |
| プライバシー | 行動データはローカル処理優先、クラウドは匿名化 |
| スケーラビリティ | キャンバスあたり100+オブジェクト、10+同時接続 |

---

## マイルストーン（案）

| フェーズ | 内容 | 目標 |
|---------|------|------|
| α | 共有キャンバス + リアルタイム同期 | 基盤構築 |
| β | 環境型エージェント（意図推論v1）| コアUX検証 |
| γ | 信頼グラデーション + 人間コミュニケーション | 完成度向上 |
| 1.0 | Hiveユーザー移行 + パブリックリリース | ローンチ |
